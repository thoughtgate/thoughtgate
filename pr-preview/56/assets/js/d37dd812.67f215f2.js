"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[728],{3212(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"tutorials/wrap-first-agent","title":"Wrap Your First Agent","description":"In this tutorial, you\'ll wrap Claude Code with ThoughtGate to govern its MCP tool calls. You\'ll start with a passthrough config, add deny rules, and try development mode \u2014 all without modifying Claude Code\'s source.","source":"@site/docs/tutorials/wrap-first-agent.md","sourceDirName":"tutorials","slug":"/tutorials/wrap-first-agent","permalink":"/pr-preview/56/docs/tutorials/wrap-first-agent","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/tutorials/wrap-first-agent.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Introduction","permalink":"/pr-preview/56/docs/"},"next":{"title":"Your First ThoughtGate Proxy","permalink":"/pr-preview/56/docs/tutorials/first-proxy"}}');var s=t(4848),o=t(8453);const l={sidebar_position:1},i="Wrap Your First Agent",d={},a=[{value:"What You&#39;ll Learn",id:"what-youll-learn",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Install ThoughtGate",id:"step-1-install-thoughtgate",level:2},{value:"Step 2: Create a Minimal Config",id:"step-2-create-a-minimal-config",level:2},{value:"Step 3: Preview with Dry Run",id:"step-3-preview-with-dry-run",level:2},{value:"Step 4: Wrap the Agent",id:"step-4-wrap-the-agent",level:2},{value:"Step 5: Observe Governance Logs",id:"step-5-observe-governance-logs",level:2},{value:"Step 6: Add a Deny Rule",id:"step-6-add-a-deny-rule",level:2},{value:"Step 7: Try Development Mode",id:"step-7-try-development-mode",level:2},{value:"Step 8: Switch to Production",id:"step-8-switch-to-production",level:2},{value:"What&#39;s Next",id:"whats-next",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"wrap-your-first-agent",children:"Wrap Your First Agent"})}),"\n",(0,s.jsx)(n.p,{children:"In this tutorial, you'll wrap Claude Code with ThoughtGate to govern its MCP tool calls. You'll start with a passthrough config, add deny rules, and try development mode \u2014 all without modifying Claude Code's source."}),"\n",(0,s.jsx)(n.h2,{id:"what-youll-learn",children:"What You'll Learn"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["How ",(0,s.jsx)(n.code,{children:"thoughtgate wrap"})," discovers and rewrites agent configs"]}),"\n",(0,s.jsx)(n.li,{children:"How governance rules control tool calls"}),"\n",(0,s.jsxs)(n.li,{children:["How ",(0,s.jsx)(n.code,{children:"--dry-run"})," previews changes safely"]}),"\n",(0,s.jsx)(n.li,{children:"How profiles let you observe before enforcing"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rust 1.87+"})," installed (",(0,s.jsx)(n.code,{children:"rustup update"})," if needed)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Claude Code"})," installed and working (",(0,s.jsx)(n.code,{children:"claude --version"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["At least one MCP server configured in Claude Code (check ",(0,s.jsx)(n.code,{children:"~/.claude.json"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-1-install-thoughtgate",children:"Step 1: Install ThoughtGate"}),"\n",(0,s.jsx)(n.p,{children:"Build and install the CLI binary:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/thoughtgate/thoughtgate\ncd thoughtgate\ncargo install --path thoughtgate\n"})}),"\n",(0,s.jsx)(n.p,{children:"Verify the installation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"thoughtgate --help\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You should see the ",(0,s.jsx)(n.code,{children:"wrap"})," and ",(0,s.jsx)(n.code,{children:"shim"})," subcommands listed."]}),"\n",(0,s.jsx)(n.h2,{id:"step-2-create-a-minimal-config",children:"Step 2: Create a Minimal Config"}),"\n",(0,s.jsxs)(n.p,{children:["Create ",(0,s.jsx)(n.code,{children:"thoughtgate.yaml"})," in your project directory with a passthrough configuration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"schema: 1\n\nsources:\n  - id: upstream\n    kind: mcp\n    url: http://localhost:3000  # Unused in stdio mode, but required by schema\n\ngovernance:\n  defaults:\n    action: forward  # Forward everything \u2014 no blocking yet\n"})}),"\n",(0,s.jsx)(n.p,{children:"This config forwards all tool calls without any governance. We'll add rules shortly."}),"\n",(0,s.jsx)(n.h2,{id:"step-3-preview-with-dry-run",children:"Step 3: Preview with Dry Run"}),"\n",(0,s.jsxs)(n.p,{children:["Before making any changes, use ",(0,s.jsx)(n.code,{children:"--dry-run"})," to see what ThoughtGate would do:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap --dry-run -- claude-code\n"})}),"\n",(0,s.jsx)(n.p,{children:"ThoughtGate will:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Auto-detect Claude Code from the command name"}),"\n",(0,s.jsxs)(n.li,{children:["Find ",(0,s.jsx)(n.code,{children:"~/.claude.json"})," and read your MCP server configs"]}),"\n",(0,s.jsxs)(n.li,{children:["Print the config diff showing how each server's ",(0,s.jsx)(n.code,{children:"command"})," would be rewritten"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Detected agent: ClaudeCode\nConfig file: /Users/you/.claude.json\nServers found: 2 (filesystem, github)\n\n--- original\n+++ rewritten\n  "filesystem": {\n-   "command": "npx",\n-   "args": ["-y", "@modelcontextprotocol/server-filesystem", "/tmp"]\n+   "command": "/Users/you/.cargo/bin/thoughtgate",\n+   "args": ["shim", "--server-id", "filesystem", "--governance-endpoint",\n+            "http://127.0.0.1:0", "--profile", "production",\n+            "--", "npx", "-y", "@modelcontextprotocol/server-filesystem", "/tmp"]\n  }\n'})}),"\n",(0,s.jsx)(n.p,{children:"No files are modified during a dry run."}),"\n",(0,s.jsx)(n.h2,{id:"step-4-wrap-the-agent",children:"Step 4: Wrap the Agent"}),"\n",(0,s.jsx)(n.p,{children:"Run Claude Code through ThoughtGate:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap -- claude-code\n"})}),"\n",(0,s.jsx)(n.p,{children:"ThoughtGate will:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Back up ",(0,s.jsx)(n.code,{children:"~/.claude.json"})," to ",(0,s.jsx)(n.code,{children:"~/.claude.json.thoughtgate-backup"})]}),"\n",(0,s.jsx)(n.li,{children:"Start the governance HTTP service on an ephemeral port"}),"\n",(0,s.jsx)(n.li,{children:"Rewrite your MCP server configs to route through ThoughtGate shims"}),"\n",(0,s.jsx)(n.li,{children:"Launch Claude Code"}),"\n",(0,s.jsx)(n.li,{children:"Restore the original config when you exit"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Use Claude Code normally. All tool calls pass through because ",(0,s.jsx)(n.code,{children:"defaults.action: forward"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"step-5-observe-governance-logs",children:"Step 5: Observe Governance Logs"}),"\n",(0,s.jsx)(n.p,{children:"While Claude Code is running, watch the ThoughtGate logs. Every tool call is logged:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"INFO  governance: tool=read_file server=filesystem action=forward\nINFO  governance: tool=list_files server=filesystem action=forward\n"})}),"\n",(0,s.jsx)(n.p,{children:"This confirms ThoughtGate is intercepting and forwarding tool calls."}),"\n",(0,s.jsx)(n.h2,{id:"step-6-add-a-deny-rule",children:"Step 6: Add a Deny Rule"}),"\n",(0,s.jsx)(n.p,{children:"Exit Claude Code (Ctrl+C or quit normally \u2014 ThoughtGate restores your config automatically)."}),"\n",(0,s.jsxs)(n.p,{children:["Update ",(0,s.jsx)(n.code,{children:"thoughtgate.yaml"})," to deny admin tools:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'schema: 1\n\nsources:\n  - id: upstream\n    kind: mcp\n    url: http://localhost:3000\n\ngovernance:\n  defaults:\n    action: forward\n  rules:\n    - match: "admin_*"\n      action: deny\n    - match: "delete_*"\n      action: deny\n'})}),"\n",(0,s.jsx)(n.p,{children:"Re-wrap and try calling a denied tool:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap -- claude-code\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If the agent tries to call ",(0,s.jsx)(n.code,{children:"delete_user"})," or ",(0,s.jsx)(n.code,{children:"admin_reset"}),", it receives a ",(0,s.jsx)(n.code,{children:"-32003 PolicyDenied"})," error instead of the tool executing."]}),"\n",(0,s.jsx)(n.h2,{id:"step-7-try-development-mode",children:"Step 7: Try Development Mode"}),"\n",(0,s.jsxs)(n.p,{children:["Development mode lets you observe what ",(0,s.jsx)(n.strong,{children:"would"})," be blocked without actually blocking:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap --profile development -- claude-code\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now when a denied tool is called, you'll see:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"WOULD_BLOCK tool=delete_user rule=delete_* action=deny\n"})}),"\n",(0,s.jsx)(n.p,{children:"But the call still goes through to the server. This is perfect for testing rules before enforcing them."}),"\n",(0,s.jsx)(n.h2,{id:"step-8-switch-to-production",children:"Step 8: Switch to Production"}),"\n",(0,s.jsx)(n.p,{children:"Once you're satisfied with your rules, switch to production (the default):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap -- claude-code\n"})}),"\n",(0,s.jsx)(n.p,{children:"In production mode:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deny rules"})," return errors to the agent"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Approve rules"})," would create Slack approval workflows (requires Slack token)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Governance errors"})," fail closed (deny on error)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"whats-next",children:"What's Next"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/how-to/wrap-agents",children:"Wrap other agents"})," \u2014 Cursor, VS Code, Windsurf, Zed, Claude Desktop"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/how-to/write-policies",children:"Write governance policies"})," \u2014 Complex rules with Cedar"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/how-to/use-profiles",children:"Use profiles"})," \u2014 Deep dive on development vs production"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/explanation/architecture",children:"Architecture"})," \u2014 How the 4-gate model works"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/reference/cli",children:"CLI Reference"})," \u2014 Complete flag documentation"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>l,x:()=>i});var r=t(6540);const s={},o=r.createContext(s);function l(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);