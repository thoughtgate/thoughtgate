"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[888],{7770(e,t,n){n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"tutorials/first-proxy","title":"Your First ThoughtGate Proxy","description":"In this tutorial, you\'ll set up ThoughtGate to proxy requests between an AI agent and an MCP server, with governance rules that require approval for destructive operations.","source":"@site/docs/tutorials/first-proxy.md","sourceDirName":"tutorials","slug":"/tutorials/first-proxy","permalink":"/pr-preview/40/docs/tutorials/first-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/tutorials/first-proxy.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Introduction","permalink":"/pr-preview/40/docs/"},"next":{"title":"Quickstart","permalink":"/pr-preview/40/docs/how-to/quickstart"}}');var r=n(4848),a=n(8453);const l={sidebar_position:1},o="Your First ThoughtGate Proxy",i={},c=[{value:"What You&#39;ll Learn",id:"what-youll-learn",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Build ThoughtGate",id:"step-1-build-thoughtgate",level:2},{value:"Step 2: Start a Mock MCP Server",id:"step-2-start-a-mock-mcp-server",level:2},{value:"Step 3: Create a Configuration File",id:"step-3-create-a-configuration-file",level:2},{value:"Step 4: Configure Slack Integration",id:"step-4-configure-slack-integration",level:2},{value:"Step 5: Start ThoughtGate",id:"step-5-start-thoughtgate",level:2},{value:"Step 6: Test the Proxy",id:"step-6-test-the-proxy",level:2},{value:"Step 7: Trigger an Approval",id:"step-7-trigger-an-approval",level:2},{value:"Step 8: Poll for the Result",id:"step-8-poll-for-the-result",level:2},{value:"Step 9: Verify Health",id:"step-9-verify-health",level:2},{value:"What&#39;s Next?",id:"whats-next",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"your-first-thoughtgate-proxy",children:"Your First ThoughtGate Proxy"})}),"\n",(0,r.jsx)(t.p,{children:"In this tutorial, you'll set up ThoughtGate to proxy requests between an AI agent and an MCP server, with governance rules that require approval for destructive operations."}),"\n",(0,r.jsx)(t.h2,{id:"what-youll-learn",children:"What You'll Learn"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"How to run ThoughtGate as a proxy"}),"\n",(0,r.jsx)(t.li,{children:"How to write YAML governance rules"}),"\n",(0,r.jsx)(t.li,{children:"How to configure Slack approvals"}),"\n",(0,r.jsx)(t.li,{children:"How the SEP-1686 task flow works"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Rust 1.75+ installed"}),"\n",(0,r.jsx)(t.li,{children:"An MCP server running (or use the mock server)"}),"\n",(0,r.jsx)(t.li,{children:"A Slack workspace with bot token (for approvals)"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"step-1-build-thoughtgate",children:"Step 1: Build ThoughtGate"}),"\n",(0,r.jsx)(t.p,{children:"Clone the repository and build the release binary:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"git clone https://github.com/thoughtgate/thoughtgate\ncd thoughtgate\ncargo build --release\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The binary will be at ",(0,r.jsx)(t.code,{children:"target/release/thoughtgate"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"step-2-start-a-mock-mcp-server",children:"Step 2: Start a Mock MCP Server"}),"\n",(0,r.jsx)(t.p,{children:"For testing, ThoughtGate includes a mock MCP server:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cargo build --release --features mock\n./target/release/mock_llm --port 3000\n"})}),"\n",(0,r.jsx)(t.p,{children:"This server responds to MCP tool calls with mock data."}),"\n",(0,r.jsx)(t.h2,{id:"step-3-create-a-configuration-file",children:"Step 3: Create a Configuration File"}),"\n",(0,r.jsxs)(t.p,{children:["Create ",(0,r.jsx)(t.code,{children:"thoughtgate.yaml"})," with governance rules:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'schema: 1\n\nsources:\n  - id: upstream\n    kind: mcp\n    url: http://localhost:3000\n\ngovernance:\n  defaults:\n    action: forward  # Allow by default\n  rules:\n    # Require approval for destructive operations\n    - match: "delete_*"\n      action: approve\n    - match: "drop_*"\n      action: approve\n    # Block admin tools entirely\n    - match: "admin_*"\n      action: deny\n\napproval:\n  default:\n    adapter: slack\n    channel: "#thoughtgate-approvals"\n    timeout: 5m\n'})}),"\n",(0,r.jsx)(t.h2,{id:"step-4-configure-slack-integration",children:"Step 4: Configure Slack Integration"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Create a Slack app at ",(0,r.jsx)(t.a,{href:"https://api.slack.com/apps",children:"api.slack.com/apps"})]}),"\n",(0,r.jsxs)(t.li,{children:["Add Bot Token Scopes:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"chat:write"})," \u2014 Post approval messages"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"reactions:read"})," \u2014 Detect approval reactions"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"channels:history"})," \u2014 Poll channel for reactions"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"users:read"})," \u2014 Resolve user display names"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.li,{children:"Install to your workspace"}),"\n",(0,r.jsx)(t.li,{children:"Copy the Bot OAuth Token"}),"\n",(0,r.jsxs)(t.li,{children:["Create a channel for approvals (e.g., ",(0,r.jsx)(t.code,{children:"#thoughtgate-approvals"}),")"]}),"\n",(0,r.jsxs)(t.li,{children:["Invite the bot: ",(0,r.jsx)(t.code,{children:"/invite @YourBotName"})]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"step-5-start-thoughtgate",children:"Step 5: Start ThoughtGate"}),"\n",(0,r.jsx)(t.p,{children:"Set environment variables and start the proxy:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"export THOUGHTGATE_CONFIG=./thoughtgate.yaml\nexport SLACK_BOT_TOKEN=xoxb-your-token\n\n./target/release/thoughtgate\n"})}),"\n",(0,r.jsx)(t.p,{children:"You should see:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"ThoughtGate listening on 0.0.0.0:7467\nAdmin server on 0.0.0.0:7469\nUpstream: http://localhost:3000\n"})}),"\n",(0,r.jsx)(t.h2,{id:"step-6-test-the-proxy",children:"Step 6: Test the Proxy"}),"\n",(0,r.jsxs)(t.p,{children:["Send a ",(0,r.jsx)(t.code,{children:"tools/list"})," request (should pass through):"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://localhost:7467 \\\n  -H "Content-Type: application/json" \\\n  -d \'{"jsonrpc": "2.0", "method": "tools/list", "id": 1}\'\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Send a safe ",(0,r.jsx)(t.code,{children:"tools/call"})," request (should pass through):"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://localhost:7467 \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "tools/call",\n    "params": {"name": "get_weather", "arguments": {"city": "London"}},\n    "id": 2\n  }\'\n'})}),"\n",(0,r.jsx)(t.h2,{id:"step-7-trigger-an-approval",children:"Step 7: Trigger an Approval"}),"\n",(0,r.jsxs)(t.p,{children:["Send a destructive ",(0,r.jsx)(t.code,{children:"tools/call"})," request:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://localhost:7467 \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "tools/call",\n    "params": {"name": "delete_user", "arguments": {"user_id": "12345"}},\n    "id": 3\n  }\'\n'})}),"\n",(0,r.jsx)(t.p,{children:"With SEP-1686 async tasks, you'll receive a task ID immediately:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "result": {\n    "taskId": "tg_abc123xyz",\n    "status": "working"\n  },\n  "id": 3\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"Check your Slack channel \u2014 you should see a message like:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'\ud83d\udd12 Approval Required: delete_user\n\nTool: delete_user\nPrincipal: unknown\nArguments:\n{\n  "user_id": "12345"\n}\n\nReact with \ud83d\udc4d to approve or \ud83d\udc4e to reject\n\nTask ID: tg_abc123xyz \u2022 Expires: 2024-01-15 10:30 UTC\n'})}),"\n",(0,r.jsx)(t.h2,{id:"step-8-poll-for-the-result",children:"Step 8: Poll for the Result"}),"\n",(0,r.jsxs)(t.p,{children:["The agent polls for the result using ",(0,r.jsx)(t.code,{children:"tasks/get"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://localhost:7467 \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "tasks/get",\n    "params": {"taskId": "tg_abc123xyz"},\n    "id": 4\n  }\'\n'})}),"\n",(0,r.jsx)(t.p,{children:"While waiting for approval:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "result": {\n    "taskId": "tg_abc123xyz",\n    "status": "working",\n    "statusMessage": "Waiting for human approval"\n  },\n  "id": 4\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"React with \ud83d\udc4d in Slack, then poll again:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "result": {\n    "taskId": "tg_abc123xyz",\n    "status": "completed"\n  },\n  "id": 4\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Then fetch the result with ",(0,r.jsx)(t.code,{children:"tasks/result"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://localhost:7467 \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "tasks/result",\n    "params": {"taskId": "tg_abc123xyz"},\n    "id": 5\n  }\'\n'})}),"\n",(0,r.jsx)(t.h2,{id:"step-9-verify-health",children:"Step 9: Verify Health"}),"\n",(0,r.jsx)(t.p,{children:"Check the health endpoints on the admin port:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"curl http://localhost:7469/health\ncurl http://localhost:7469/ready\n"})}),"\n",(0,r.jsx)(t.h2,{id:"whats-next",children:"What's Next?"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Learn how to ",(0,r.jsx)(t.a,{href:"/docs/how-to/write-policies",children:"write more complex policies"})]}),"\n",(0,r.jsxs)(t.li,{children:["Understand the ",(0,r.jsx)(t.a,{href:"/docs/explanation/architecture",children:"4-Gate architecture"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/docs/how-to/deploy-kubernetes",children:"Deploy to Kubernetes"})," for production"]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453(e,t,n){n.d(t,{R:()=>l,x:()=>o});var s=n(6540);const r={},a=s.createContext(r);function l(e){const t=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);