"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[79],{5484(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"how-to/write-policies","title":"Write Governance Rules","description":"This guide shows you how to write governance rules to control which MCP tool calls require approval.","source":"@site/docs/how-to/write-policies.md","sourceDirName":"how-to","slug":"/how-to/write-policies","permalink":"/pr-preview/41/docs/how-to/write-policies","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/how-to/write-policies.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Install ThoughtGate","permalink":"/pr-preview/41/docs/how-to/install"},"next":{"title":"Deploy to Kubernetes","permalink":"/pr-preview/41/docs/how-to/deploy-kubernetes"}}');var a=r(4848),l=r(8453);const s={sidebar_position:3},i="Write Governance Rules",c={},o=[{value:"YAML Rules (Primary)",id:"yaml-rules-primary",level:2},{value:"Basic Structure",id:"basic-structure",level:3},{value:"Actions",id:"actions",level:3},{value:"Pattern Matching",id:"pattern-matching",level:3},{value:"Rule Order",id:"rule-order",level:3},{value:"Approval Workflows",id:"approval-workflows",level:2},{value:"Cedar Policies (Advanced)",id:"cedar-policies-advanced",level:2},{value:"Cedar Policy Syntax",id:"cedar-policy-syntax",level:3},{value:"Cedar Actions",id:"cedar-actions",level:3},{value:"Resource Attributes",id:"resource-attributes",level:3},{value:"Examples",id:"examples",level:2},{value:"Read-Only Safe, Write Requires Approval",id:"read-only-safe-write-requires-approval",level:3},{value:"Block Admin, Approve Destructive",id:"block-admin-approve-destructive",level:3},{value:"Different Channels by Severity",id:"different-channels-by-severity",level:3},{value:"Testing Rules",id:"testing-rules",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"write-governance-rules",children:"Write Governance Rules"})}),"\n",(0,a.jsx)(n.p,{children:"This guide shows you how to write governance rules to control which MCP tool calls require approval."}),"\n",(0,a.jsx)(n.h2,{id:"yaml-rules-primary",children:"YAML Rules (Primary)"}),"\n",(0,a.jsx)(n.p,{children:"Most use cases can be handled with simple YAML rules. Cedar policies are optional for complex logic."}),"\n",(0,a.jsx)(n.h3,{id:"basic-structure",children:"Basic Structure"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'governance:\n  defaults:\n    action: forward  # Default action when no rule matches\n  rules:\n    - match: "pattern"\n      action: forward|approve|deny|policy\n'})}),"\n",(0,a.jsx)(n.h3,{id:"actions",children:"Actions"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Action"}),(0,a.jsx)(n.th,{children:"Behavior"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"forward"})}),(0,a.jsx)(n.td,{children:"Send to upstream immediately"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"deny"})}),(0,a.jsx)(n.td,{children:"Return error immediately"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"approve"})}),(0,a.jsx)(n.td,{children:"Create task, post to Slack, wait for approval"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"policy"})}),(0,a.jsx)(n.td,{children:"Evaluate Cedar policy for complex logic"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"pattern-matching",children:"Pattern Matching"}),"\n",(0,a.jsx)(n.p,{children:"Rules use glob patterns:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'rules:\n  # Exact match\n  - match: "delete_user"\n    action: approve\n\n  # Wildcard suffix\n  - match: "delete_*"\n    action: approve\n\n  # Wildcard prefix\n  - match: "*_dangerous"\n    action: deny\n\n  # Single character wildcard\n  - match: "tool_?"\n    action: forward\n'})}),"\n",(0,a.jsx)(n.h3,{id:"rule-order",children:"Rule Order"}),"\n",(0,a.jsx)(n.p,{children:"Rules are evaluated top-to-bottom. First match wins."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'rules:\n  # Most specific first\n  - match: "admin_read_*"\n    action: forward\n  \n  # Then broader patterns\n  - match: "admin_*"\n    action: deny\n  \n  # Catch-all (or use defaults)\n  - match: "*"\n    action: forward\n'})}),"\n",(0,a.jsx)(n.h2,{id:"approval-workflows",children:"Approval Workflows"}),"\n",(0,a.jsx)(n.p,{children:"Link rules to named approval workflows:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'governance:\n  rules:\n    - match: "delete_*"\n      action: approve\n      approval: ops-team\n    - match: "transfer_*"\n      action: approve\n      approval: finance-team\n\napproval:\n  ops-team:\n    adapter: slack\n    channel: "#ops-approvals"\n    timeout: 5m\n  finance-team:\n    adapter: slack\n    channel: "#finance-approvals"\n    timeout: 10m\n'})}),"\n",(0,a.jsx)(n.h2,{id:"cedar-policies-advanced",children:"Cedar Policies (Advanced)"}),"\n",(0,a.jsx)(n.p,{children:"For complex access control logic, use Cedar policies:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'governance:\n  rules:\n    - match: "transfer_*"\n      action: policy\n      policy_id: transfer-rules\n\ncedar:\n  policy_path: /etc/thoughtgate/policies.cedar\n'})}),"\n",(0,a.jsx)(n.h3,{id:"cedar-policy-syntax",children:"Cedar Policy Syntax"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cedar",children:'// Forward low-value transfers\npermit(\n    principal,\n    action == Action::"Forward",\n    resource\n) when {\n    resource.tool_name == "transfer_funds" &&\n    resource.arguments.amount <= 1000\n};\n\n// Require approval for high-value transfers\npermit(\n    principal,\n    action == Action::"Approve",\n    resource\n) when {\n    resource.tool_name == "transfer_funds" &&\n    resource.arguments.amount > 1000\n};\n'})}),"\n",(0,a.jsx)(n.h3,{id:"cedar-actions",children:"Cedar Actions"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Cedar Action"}),(0,a.jsx)(n.th,{children:"Behavior"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:'Action::"Forward"'})}),(0,a.jsx)(n.td,{children:"Send to upstream immediately"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:'Action::"Approve"'})}),(0,a.jsx)(n.td,{children:"Require human approval"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:'Action::"Deny"'})}),(0,a.jsx)(n.td,{children:"Reject immediately"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"resource-attributes",children:"Resource Attributes"}),"\n",(0,a.jsxs)(n.p,{children:["For ",(0,a.jsx)(n.code,{children:"tools/call"})," requests:"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Attribute"}),(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"resource.tool_name"})}),(0,a.jsx)(n.td,{children:"String"}),(0,a.jsx)(n.td,{children:"Name of the tool"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"resource.arguments"})}),(0,a.jsx)(n.td,{children:"Object"}),(0,a.jsx)(n.td,{children:"Tool arguments (JSON)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"resource.method"})}),(0,a.jsx)(n.td,{children:"String"}),(0,a.jsx)(n.td,{children:"MCP method name"})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(n.h3,{id:"read-only-safe-write-requires-approval",children:"Read-Only Safe, Write Requires Approval"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'governance:\n  defaults:\n    action: forward\n  rules:\n    - match: "get_*"\n      action: forward\n    - match: "list_*"\n      action: forward\n    - match: "create_*"\n      action: approve\n    - match: "update_*"\n      action: approve\n    - match: "delete_*"\n      action: approve\n'})}),"\n",(0,a.jsx)(n.h3,{id:"block-admin-approve-destructive",children:"Block Admin, Approve Destructive"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'governance:\n  defaults:\n    action: forward\n  rules:\n    - match: "admin_*"\n      action: deny\n    - match: "delete_*"\n      action: approve\n    - match: "drop_*"\n      action: approve\n'})}),"\n",(0,a.jsx)(n.h3,{id:"different-channels-by-severity",children:"Different Channels by Severity"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'governance:\n  defaults:\n    action: forward\n  rules:\n    - match: "delete_*"\n      action: approve\n      approval: critical\n    - match: "update_*"\n      action: approve\n      approval: standard\n\napproval:\n  critical:\n    adapter: slack\n    channel: "#critical-ops"\n    timeout: 2m\n  standard:\n    adapter: slack\n    channel: "#approvals"\n    timeout: 10m\n'})}),"\n",(0,a.jsx)(n.h2,{id:"testing-rules",children:"Testing Rules"}),"\n",(0,a.jsx)(n.p,{children:"Validate your configuration:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Check YAML syntax\ncat thoughtgate.yaml | python -c "import sys, yaml; yaml.safe_load(sys.stdin)"\n\n# Start ThoughtGate and test\nexport THOUGHTGATE_CONFIG=./thoughtgate.yaml\n./thoughtgate &\n\n# Test a forwarded request\ncurl -X POST http://localhost:7467 \\\n  -d \'{"jsonrpc":"2.0","method":"tools/call","params":{"name":"get_user"},"id":1}\'\n\n# Test a denied request\ncurl -X POST http://localhost:7467 \\\n  -d \'{"jsonrpc":"2.0","method":"tools/call","params":{"name":"admin_delete"},"id":2}\'\n'})}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["See the full ",(0,a.jsx)(n.a,{href:"/docs/reference/configuration",children:"Configuration Reference"})]}),"\n",(0,a.jsxs)(n.li,{children:["Understand the ",(0,a.jsx)(n.a,{href:"/docs/explanation/architecture",children:"4-Gate Architecture"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>s,x:()=>i});var t=r(6540);const a={},l=t.createContext(a);function s(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);