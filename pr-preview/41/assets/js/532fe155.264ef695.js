"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[759],{168(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"explanation/traffic-tiers","title":"Traffic Routing","description":"ThoughtGate routes all traffic based on governance rules and policy evaluation. Each request is classified and handled according to its action.","source":"@site/docs/explanation/traffic-tiers.md","sourceDirName":"explanation","slug":"/explanation/traffic-tiers","permalink":"/pr-preview/41/docs/explanation/traffic-tiers","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/explanation/traffic-tiers.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Architecture","permalink":"/pr-preview/41/docs/explanation/architecture"},"next":{"title":"Security Model","permalink":"/pr-preview/41/docs/explanation/security-model"}}');var r=i(4848),t=i(8453);const l={sidebar_position:3},a="Traffic Routing",c={},o=[{value:"Overview",id:"overview",level:2},{value:"Forward Action",id:"forward-action",level:2},{value:"Characteristics",id:"characteristics",level:3},{value:"Typical Use Cases",id:"typical-use-cases",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Deny Action",id:"deny-action",level:2},{value:"Characteristics",id:"characteristics-1",level:3},{value:"Typical Use Cases",id:"typical-use-cases-1",level:3},{value:"Configuration",id:"configuration-1",level:3},{value:"Approve Action",id:"approve-action",level:2},{value:"Characteristics",id:"characteristics-2",level:3},{value:"Typical Use Cases",id:"typical-use-cases-2",level:3},{value:"Configuration",id:"configuration-2",level:3},{value:"SEP-1686 Task Flow",id:"sep-1686-task-flow",level:3},{value:"Policy Action",id:"policy-action",level:2},{value:"Characteristics",id:"characteristics-3",level:3},{value:"Typical Use Cases",id:"typical-use-cases-3",level:3},{value:"Configuration",id:"configuration-3",level:3},{value:"Action Selection Logic",id:"action-selection-logic",level:2},{value:"Performance Implications",id:"performance-implications",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Choosing the Right Action",id:"choosing-the-right-action",level:2},{value:"Use Forward When",id:"use-forward-when",level:3},{value:"Use Deny When",id:"use-deny-when",level:3},{value:"Use Approve When",id:"use-approve-when",level:3},{value:"Use Policy When",id:"use-policy-when",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"traffic-routing",children:"Traffic Routing"})}),"\n",(0,r.jsx)(n.p,{children:"ThoughtGate routes all traffic based on governance rules and policy evaluation. Each request is classified and handled according to its action."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Action"}),(0,r.jsx)(n.th,{children:"Behavior"}),(0,r.jsx)(n.th,{children:"Latency"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"forward"})}),(0,r.jsx)(n.td,{children:"Send to upstream immediately"}),(0,r.jsx)(n.td,{children:"< 2 ms"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"deny"})}),(0,r.jsx)(n.td,{children:"Return error immediately"}),(0,r.jsx)(n.td,{children:"< 1 ms"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"approve"})}),(0,r.jsx)(n.td,{children:"Create task, wait for human"}),(0,r.jsx)(n.td,{children:"Variable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"policy"})}),(0,r.jsx)(n.td,{children:"Evaluate Cedar, then route"}),(0,r.jsx)(n.td,{children:"< 5 ms"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"forward-action",children:"Forward Action"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Fast path for trusted, low-risk operations."]}),"\n",(0,r.jsx)(n.h3,{id:"characteristics",children:"Characteristics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Minimal processing"}),"\n",(0,r.jsx)(n.li,{children:"Direct forwarding to upstream"}),"\n",(0,r.jsx)(n.li,{children:"Responses passed through unchanged"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"typical-use-cases",children:"Typical Use Cases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tools/list"})," \u2014 Listing available tools"]}),"\n",(0,r.jsx)(n.li,{children:"Read-only queries"}),"\n",(0,r.jsx)(n.li,{children:"Idempotent operations"}),"\n",(0,r.jsx)(n.li,{children:"Internal/trusted tool calls"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'governance:\n  defaults:\n    action: forward\n  rules:\n    - match: "get_*"\n      action: forward\n    - match: "list_*"\n      action: forward\n'})}),"\n",(0,r.jsx)(n.h2,{id:"deny-action",children:"Deny Action"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Block dangerous or unauthorized operations."]}),"\n",(0,r.jsx)(n.h3,{id:"characteristics-1",children:"Characteristics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Immediate rejection"}),"\n",(0,r.jsx)(n.li,{children:"No upstream communication"}),"\n",(0,r.jsxs)(n.li,{children:["Clear error response (",(0,r.jsx)(n.code,{children:"-32003 PolicyDenied"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"typical-use-cases-1",children:"Typical Use Cases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Administrative tools"}),"\n",(0,r.jsx)(n.li,{children:"Known attack patterns"}),"\n",(0,r.jsx)(n.li,{children:"Blocked tool categories"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-1",children:"Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'governance:\n  rules:\n    - match: "admin_*"\n      action: deny\n    - match: "debug_*"\n      action: deny\n'})}),"\n",(0,r.jsx)(n.h2,{id:"approve-action",children:"Approve Action"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Human-in-the-loop for sensitive operations."]}),"\n",(0,r.jsx)(n.h3,{id:"characteristics-2",children:"Characteristics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creates SEP-1686 task"}),"\n",(0,r.jsx)(n.li,{children:"Posts message to Slack"}),"\n",(0,r.jsx)(n.li,{children:"Agent receives task ID immediately"}),"\n",(0,r.jsx)(n.li,{children:"Agent polls for completion"}),"\n",(0,r.jsx)(n.li,{children:"On approval: forwards to upstream"}),"\n",(0,r.jsx)(n.li,{children:"On rejection: returns error"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"typical-use-cases-2",children:"Typical Use Cases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Destructive operations (delete, drop, remove)"}),"\n",(0,r.jsx)(n.li,{children:"Financial transactions"}),"\n",(0,r.jsx)(n.li,{children:"PII modifications"}),"\n",(0,r.jsx)(n.li,{children:"Privilege escalation"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-2",children:"Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'governance:\n  rules:\n    - match: "delete_*"\n      action: approve\n      approval: ops-team\n    - match: "transfer_*"\n      action: approve\n      approval: finance-team\n\napproval:\n  ops-team:\n    adapter: slack\n    channel: "#ops-approvals"\n    timeout: 5m\n  finance-team:\n    adapter: slack\n    channel: "#finance-approvals"\n    timeout: 10m\n'})}),"\n",(0,r.jsx)(n.h3,{id:"sep-1686-task-flow",children:"SEP-1686 Task Flow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Agent calls ",(0,r.jsx)(n.code,{children:"tools/call"})," with sensitive tool"]}),"\n",(0,r.jsxs)(n.li,{children:["ThoughtGate returns: ",(0,r.jsx)(n.code,{children:'{taskId: "tg_abc123", status: "working"}'})]}),"\n",(0,r.jsx)(n.li,{children:"Slack message posted"}),"\n",(0,r.jsxs)(n.li,{children:["Agent polls ",(0,r.jsx)(n.code,{children:"tasks/get"})," periodically"]}),"\n",(0,r.jsx)(n.li,{children:"Human reacts \ud83d\udc4d or \ud83d\udc4e"}),"\n",(0,r.jsxs)(n.li,{children:["Task status changes to ",(0,r.jsx)(n.code,{children:"completed"})," or ",(0,r.jsx)(n.code,{children:"rejected"})]}),"\n",(0,r.jsxs)(n.li,{children:["Agent calls ",(0,r.jsx)(n.code,{children:"tasks/result"})," to get the response"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"policy-action",children:"Policy Action"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Complex access control logic using Cedar."]}),"\n",(0,r.jsx)(n.h3,{id:"characteristics-3",children:"Characteristics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Evaluates Cedar policy"}),"\n",(0,r.jsx)(n.li,{children:"Can check argument values"}),"\n",(0,r.jsx)(n.li,{children:"Returns forward, approve, or deny"}),"\n",(0,r.jsx)(n.li,{children:"Slightly higher latency"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"typical-use-cases-3",children:"Typical Use Cases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Conditional approvals (e.g., amount > $10,000)"}),"\n",(0,r.jsx)(n.li,{children:"Role-based access control"}),"\n",(0,r.jsx)(n.li,{children:"Complex business rules"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-3",children:"Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'governance:\n  rules:\n    - match: "transfer_*"\n      action: policy\n      policy_id: transfer-rules\n\ncedar:\n  policy_path: /etc/thoughtgate/policies.cedar\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cedar",children:'// Low-value: forward immediately\npermit(\n    principal,\n    action == Action::"Forward",\n    resource\n) when {\n    resource.tool_name == "transfer_funds" &&\n    resource.arguments.amount <= 1000\n};\n\n// High-value: require approval\npermit(\n    principal,\n    action == Action::"Approve",\n    resource\n) when {\n    resource.tool_name == "transfer_funds" &&\n    resource.arguments.amount > 1000\n};\n'})}),"\n",(0,r.jsx)(n.h2,{id:"action-selection-logic",children:"Action Selection Logic"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  GOVERNANCE EVALUATION                   \u2502\n\u2502                                                         \u2502\n\u2502  1. Check Gate 1 (Visibility) - tool allowed?           \u2502\n\u2502  2. Evaluate rules in order (first match wins)          \u2502\n\u2502  3. If action: policy, evaluate Cedar                   \u2502\n\u2502  4. If no match, use defaults.action                    \u2502\n\u2502                                                         \u2502\n\u2502  Results:                                               \u2502\n\u2502    forward  \u2192 Send to upstream                          \u2502\n\u2502    deny     \u2192 Return -32003 error                       \u2502\n\u2502    approve  \u2192 Create task, post to Slack                \u2502\n\u2502    policy   \u2192 Cedar evaluation \u2192 forward|deny|approve   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-implications",children:"Performance Implications"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Action"}),(0,r.jsx)(n.th,{children:"p50 Latency"}),(0,r.jsx)(n.th,{children:"p99 Latency"}),(0,r.jsx)(n.th,{children:"Notes"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"forward"}),(0,r.jsx)(n.td,{children:"1-2 ms"}),(0,r.jsx)(n.td,{children:"5 ms"}),(0,r.jsx)(n.td,{children:"Network bound"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"deny"}),(0,r.jsx)(n.td,{children:"< 1 ms"}),(0,r.jsx)(n.td,{children:"2 ms"}),(0,r.jsx)(n.td,{children:"No upstream call"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"approve (initial)"}),(0,r.jsx)(n.td,{children:"3-5 ms"}),(0,r.jsx)(n.td,{children:"15 ms"}),(0,r.jsx)(n.td,{children:"Task + Slack"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"approve (total)"}),(0,r.jsx)(n.td,{children:"10s-5m"}),(0,r.jsx)(n.td,{children:"Timeout"}),(0,r.jsx)(n.td,{children:"Human bound"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"policy"}),(0,r.jsx)(n.td,{children:"2-3 ms"}),(0,r.jsx)(n.td,{children:"10 ms"}),(0,r.jsx)(n.td,{children:"Cedar evaluation"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,r.jsx)(n.p,{children:"Prometheus metrics by action:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'thoughtgate_requests_total{action="forward"}\nthoughtgate_requests_total{action="deny"}\nthoughtgate_requests_total{action="approve"}\n\nthoughtgate_request_duration_seconds{action="forward"}\nthoughtgate_request_duration_seconds{action="deny"}\nthoughtgate_request_duration_seconds{action="approve"}\n\nthoughtgate_approval_total{result="approved|rejected|timeout"}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"choosing-the-right-action",children:"Choosing the Right Action"}),"\n",(0,r.jsx)(n.h3,{id:"use-forward-when",children:"Use Forward When"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Operation is read-only"}),"\n",(0,r.jsx)(n.li,{children:"Failure is easily recoverable"}),"\n",(0,r.jsx)(n.li,{children:"No sensitive data involved"}),"\n",(0,r.jsx)(n.li,{children:"High-frequency operation"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"use-deny-when",children:"Use Deny When"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Operation should never be allowed"}),"\n",(0,r.jsx)(n.li,{children:"Clear policy violation"}),"\n",(0,r.jsx)(n.li,{children:"Known attack pattern"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"use-approve-when",children:"Use Approve When"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Operation is legitimate but sensitive"}),"\n",(0,r.jsx)(n.li,{children:"Human judgment required"}),"\n",(0,r.jsx)(n.li,{children:"Irreversible consequences"}),"\n",(0,r.jsx)(n.li,{children:"High-value transactions"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"use-policy-when",children:"Use Policy When"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Need conditional logic"}),"\n",(0,r.jsx)(n.li,{children:"Different handling based on arguments"}),"\n",(0,r.jsx)(n.li,{children:"Complex business rules"}),"\n",(0,r.jsx)(n.li,{children:"Role-based decisions"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>a});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);