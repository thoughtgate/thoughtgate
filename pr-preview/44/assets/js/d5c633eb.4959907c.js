"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[178],{5200(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"reference/policy-syntax","title":"Policy Syntax Reference","description":"ThoughtGate supports two levels of policy configuration: YAML governance rules (primary) and Cedar policies (advanced).","source":"@site/docs/reference/policy-syntax.md","sourceDirName":"reference","slug":"/reference/policy-syntax","permalink":"/pr-preview/44/docs/reference/policy-syntax","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/reference/policy-syntax.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Configuration Reference","permalink":"/pr-preview/44/docs/reference/configuration"},"next":{"title":"Error Codes Reference","permalink":"/pr-preview/44/docs/reference/error-codes"}}');var l=r(4848),c=r(8453);const s={sidebar_position:2},a="Policy Syntax Reference",d={},o=[{value:"YAML Governance Rules",id:"yaml-governance-rules",level:2},{value:"Structure",id:"structure",level:3},{value:"Pattern Syntax",id:"pattern-syntax",level:3},{value:"Actions",id:"actions",level:3},{value:"Cedar Policies (Advanced)",id:"cedar-policies-advanced",level:2},{value:"When to Use Cedar",id:"when-to-use-cedar",level:3},{value:"Structure",id:"structure-1",level:3},{value:"Cedar Actions",id:"cedar-actions",level:3},{value:"Resource Attributes",id:"resource-attributes",level:3},{value:"Conditions",id:"conditions",level:3},{value:"String Comparisons",id:"string-comparisons",level:4},{value:"Numeric Comparisons",id:"numeric-comparisons",level:4},{value:"Boolean Logic",id:"boolean-logic",level:4},{value:"Evaluation Order",id:"evaluation-order",level:3},{value:"Examples",id:"examples",level:2},{value:"YAML: Basic Governance",id:"yaml-basic-governance",level:3},{value:"YAML: Multiple Approval Channels",id:"yaml-multiple-approval-channels",level:3},{value:"Cedar: Value-Based Routing",id:"cedar-value-based-routing",level:3},{value:"Cedar: Deny with Exceptions",id:"cedar-deny-with-exceptions",level:3},{value:"Validation",id:"validation",level:2},{value:"YAML Validation",id:"yaml-validation",level:3},{value:"Cedar Validation",id:"cedar-validation",level:3},{value:"Hot Reload",id:"hot-reload",level:2}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"policy-syntax-reference",children:"Policy Syntax Reference"})}),"\n",(0,l.jsx)(n.p,{children:"ThoughtGate supports two levels of policy configuration: YAML governance rules (primary) and Cedar policies (advanced)."}),"\n",(0,l.jsx)(n.h2,{id:"yaml-governance-rules",children:"YAML Governance Rules"}),"\n",(0,l.jsx)(n.p,{children:"The primary way to configure ThoughtGate."}),"\n",(0,l.jsx)(n.h3,{id:"structure",children:"Structure"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'governance:\n  defaults:\n    action: forward  # Default when no rule matches\n  rules:\n    - match: "pattern"\n      action: forward|approve|deny|policy\n      approval: workflow-name  # For action: approve\n      policy_id: policy-name   # For action: policy\n'})}),"\n",(0,l.jsx)(n.h3,{id:"pattern-syntax",children:"Pattern Syntax"}),"\n",(0,l.jsx)(n.p,{children:"Patterns use glob matching:"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Pattern"}),(0,l.jsx)(n.th,{children:"Matches"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"delete_user"})}),(0,l.jsx)(n.td,{children:"Exact match"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"delete_*"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"delete_user"}),", ",(0,l.jsx)(n.code,{children:"delete_file"}),", etc."]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"*_dangerous"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"very_dangerous"}),", ",(0,l.jsx)(n.code,{children:"somewhat_dangerous"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"tool_?"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"tool_a"}),", ",(0,l.jsx)(n.code,{children:"tool_1"})," (single char)"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"[abc]_tool"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"a_tool"}),", ",(0,l.jsx)(n.code,{children:"b_tool"}),", ",(0,l.jsx)(n.code,{children:"c_tool"})]})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"actions",children:"Actions"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Action"}),(0,l.jsx)(n.th,{children:"Behavior"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"forward"})}),(0,l.jsx)(n.td,{children:"Send to upstream immediately"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"deny"})}),(0,l.jsxs)(n.td,{children:["Return ",(0,l.jsx)(n.code,{children:"-32003 PolicyDenied"})," error"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"approve"})}),(0,l.jsx)(n.td,{children:"Create SEP-1686 task, post to Slack"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"policy"})}),(0,l.jsx)(n.td,{children:"Evaluate Cedar policy for decision"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"cedar-policies-advanced",children:"Cedar Policies (Advanced)"}),"\n",(0,l.jsx)(n.p,{children:"For complex access control logic that can't be expressed in YAML."}),"\n",(0,l.jsx)(n.h3,{id:"when-to-use-cedar",children:"When to Use Cedar"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Conditional logic based on argument values"}),"\n",(0,l.jsx)(n.li,{children:"Complex boolean expressions"}),"\n",(0,l.jsx)(n.li,{children:"Role-based access control"}),"\n",(0,l.jsx)(n.li,{children:"Multi-factor decisions"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"structure-1",children:"Structure"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'permit|forbid(\n    principal,\n    action == Action::"<action>",\n    resource\n) when {\n    <conditions>\n};\n'})}),"\n",(0,l.jsx)(n.h3,{id:"cedar-actions",children:"Cedar Actions"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Action"}),(0,l.jsx)(n.th,{children:"Result"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'Action::"Forward"'})}),(0,l.jsx)(n.td,{children:"Send to upstream immediately"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'Action::"Approve"'})}),(0,l.jsx)(n.td,{children:"Require human approval"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'Action::"Deny"'})}),(0,l.jsx)(n.td,{children:"Return error"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"resource-attributes",children:"Resource Attributes"}),"\n",(0,l.jsxs)(n.p,{children:["For ",(0,l.jsx)(n.code,{children:"tools/call"})," requests:"]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Attribute"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"resource.tool_name"})}),(0,l.jsx)(n.td,{children:"String"}),(0,l.jsx)(n.td,{children:"Name of the tool being called"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"resource.arguments"})}),(0,l.jsx)(n.td,{children:"Object"}),(0,l.jsx)(n.td,{children:"Tool arguments (JSON)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"resource.method"})}),(0,l.jsx)(n.td,{children:"String"}),(0,l.jsx)(n.td,{children:"MCP method name"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"conditions",children:"Conditions"}),"\n",(0,l.jsx)(n.h4,{id:"string-comparisons",children:"String Comparisons"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'when { resource.tool_name == "delete_user" }\nwhen { resource.tool_name != "safe_tool" }\nwhen { resource.tool_name like "admin_*" }\n'})}),"\n",(0,l.jsx)(n.h4,{id:"numeric-comparisons",children:"Numeric Comparisons"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:"when { resource.arguments.amount > 10000 }\nwhen { resource.arguments.count >= 5 }\nwhen { resource.arguments.priority < 3 }\n"})}),"\n",(0,l.jsx)(n.h4,{id:"boolean-logic",children:"Boolean Logic"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'when {\n    resource.tool_name == "transfer" &&\n    resource.arguments.amount > 1000\n}\n\nwhen {\n    resource.tool_name == "delete" ||\n    resource.tool_name == "remove"\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"evaluation-order",children:"Evaluation Order"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["All ",(0,l.jsx)(n.code,{children:"forbid"})," policies evaluated first"]}),"\n",(0,l.jsx)(n.li,{children:"If any forbid matches \u2192 Deny"}),"\n",(0,l.jsxs)(n.li,{children:["All ",(0,l.jsx)(n.code,{children:"permit"})," policies evaluated"]}),"\n",(0,l.jsx)(n.li,{children:"First matching permit \u2192 Use that action"}),"\n",(0,l.jsx)(n.li,{children:"No match \u2192 Implicit deny"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,l.jsx)(n.h3,{id:"yaml-basic-governance",children:"YAML: Basic Governance"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'governance:\n  defaults:\n    action: forward\n  rules:\n    # Block admin tools\n    - match: "admin_*"\n      action: deny\n    # Approve destructive ops\n    - match: "delete_*"\n      action: approve\n    - match: "drop_*"\n      action: approve\n'})}),"\n",(0,l.jsx)(n.h3,{id:"yaml-multiple-approval-channels",children:"YAML: Multiple Approval Channels"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'governance:\n  rules:\n    - match: "delete_*"\n      action: approve\n      approval: ops\n    - match: "transfer_*"\n      action: approve\n      approval: finance\n\napproval:\n  ops:\n    adapter: slack\n    channel: "#ops"\n    timeout: 5m\n  finance:\n    adapter: slack\n    channel: "#finance"\n    timeout: 10m\n'})}),"\n",(0,l.jsx)(n.h3,{id:"cedar-value-based-routing",children:"Cedar: Value-Based Routing"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'// Low-value transfers: forward\npermit(\n    principal,\n    action == Action::"Forward",\n    resource\n) when {\n    resource.tool_name == "transfer_funds" &&\n    resource.arguments.amount <= 1000\n};\n\n// High-value transfers: approve\npermit(\n    principal,\n    action == Action::"Approve",\n    resource\n) when {\n    resource.tool_name == "transfer_funds" &&\n    resource.arguments.amount > 1000\n};\n'})}),"\n",(0,l.jsx)(n.h3,{id:"cedar-deny-with-exceptions",children:"Cedar: Deny with Exceptions"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'// Allow specific safe admin tools\npermit(\n    principal,\n    action == Action::"Forward",\n    resource\n) when {\n    resource.tool_name == "admin_read_config"\n};\n\n// Deny all other admin tools\nforbid(\n    principal,\n    action,\n    resource\n) when {\n    resource.tool_name like "admin_*"\n};\n'})}),"\n",(0,l.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,l.jsx)(n.h3,{id:"yaml-validation",children:"YAML Validation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Check YAML syntax\ncat thoughtgate.yaml | python -c "import sys, yaml; yaml.safe_load(sys.stdin)"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"cedar-validation",children:"Cedar Validation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Validate Cedar syntax\ncedar validate --policies policy.cedar\n"})}),"\n",(0,l.jsx)(n.h2,{id:"hot-reload",children:"Hot Reload"}),"\n",(0,l.jsx)(n.p,{children:"ThoughtGate watches configuration files and reloads on changes. No restart required."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Modify config file\nvim thoughtgate.yaml\n\n# ThoughtGate logs: "Configuration reloaded successfully"\n'})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},8453(e,n,r){r.d(n,{R:()=>s,x:()=>a});var i=r(6540);const l={},c=i.createContext(l);function s(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);