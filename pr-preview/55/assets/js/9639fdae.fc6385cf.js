"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[38],{8453(e,n,i){i.d(n,{R:()=>l,x:()=>c});var s=i(6540);const t={},r=s.createContext(t);function l(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(r.Provider,{value:n},e.children)}},8540(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"explanation/security-model","title":"Security Model","description":"ThoughtGate is a security boundary between AI agents and the tools they can access. Understanding its trust model is essential for secure deployment.","source":"@site/docs/explanation/security-model.md","sourceDirName":"explanation","slug":"/explanation/security-model","permalink":"/pr-preview/55/docs/explanation/security-model","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/explanation/security-model.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Traffic Routing","permalink":"/pr-preview/55/docs/explanation/traffic-tiers"}}');var t=i(4848),r=i(8453);const l={sidebar_position:4},c="Security Model",d={},o=[{value:"Trust Boundaries",id:"trust-boundaries",level:2},{value:"Threat Model",id:"threat-model",level:2},{value:"Threats Mitigated",id:"threats-mitigated",level:3},{value:"Threats NOT Mitigated",id:"threats-not-mitigated",level:3},{value:"Security Properties",id:"security-properties",level:2},{value:"1. Fail-Safe Defaults",id:"1-fail-safe-defaults",level:3},{value:"2. Policy Immutability",id:"2-policy-immutability",level:3},{value:"3. Approval Independence",id:"3-approval-independence",level:3},{value:"4. Audit Trail",id:"4-audit-trail",level:3},{value:"Deployment Security",id:"deployment-security",level:2},{value:"Network Security",id:"network-security",level:3},{value:"Secret Management",id:"secret-management",level:3},{value:"Config Protection",id:"config-protection",level:3},{value:"Slack Security",id:"slack-security",level:2},{value:"Bot Token Scopes",id:"bot-token-scopes",level:3},{value:"Channel Security",id:"channel-security",level:3},{value:"Approval Authentication",id:"approval-authentication",level:3},{value:"NDJSON Smuggling Detection",id:"ndjson-smuggling-detection",level:2},{value:"How ThoughtGate Detects It",id:"how-thoughtgate-detects-it",level:3},{value:"Profile Behavior",id:"profile-behavior",level:3},{value:"Profile Security Implications",id:"profile-security-implications",level:2},{value:"CLI Wrapper Security",id:"cli-wrapper-security",level:2},{value:"Config File Protection",id:"config-file-protection",level:3},{value:"Environment Variable Scrubbing",id:"environment-variable-scrubbing",level:3},{value:"Governance Service Binding",id:"governance-service-binding",level:3},{value:"Hardening Checklist",id:"hardening-checklist",level:2},{value:"Example Secure Deployment",id:"example-secure-deployment",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"security-model",children:"Security Model"})}),"\n",(0,t.jsx)(n.p,{children:"ThoughtGate is a security boundary between AI agents and the tools they can access. Understanding its trust model is essential for secure deployment."}),"\n",(0,t.jsx)(n.h2,{id:"trust-boundaries",children:"Trust Boundaries"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        UNTRUSTED ZONE                                \u2502\n\u2502                                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                    \u2502\n\u2502  \u2502  AI Agent   \u2502  \u2022 May be compromised by prompt injection          \u2502\n\u2502  \u2502             \u2502  \u2022 May misinterpret instructions                   \u2502\n\u2502  \u2502             \u2502  \u2022 May have bugs in reasoning                      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                    \u2502\n\u2502         \u2502                                                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      TRUST BOUNDARY                                  \u2502\n\u2502                                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                    THOUGHTGATE                               \u2502   \u2502\n\u2502  \u2502                                                              \u2502   \u2502\n\u2502  \u2502  \u2022 Enforces policies regardless of agent intent              \u2502   \u2502\n\u2502  \u2502  \u2022 Cannot be instructed by agent to bypass policies          \u2502   \u2502\n\u2502  \u2502  \u2022 Maintains audit trail                                     \u2502   \u2502\n\u2502  \u2502  \u2022 Requires human approval for sensitive operations          \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        TRUSTED ZONE                                  \u2502\n\u2502                                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                    \u2502\n\u2502  \u2502  MCP Server \u2502  \u2022 Executes tool calls                             \u2502\n\u2502  \u2502  (Tools)    \u2502  \u2022 Trusts ThoughtGate's decisions                  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                    \u2502\n\u2502                                                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h2,{id:"threat-model",children:"Threat Model"}),"\n",(0,t.jsx)(n.h3,{id:"threats-mitigated",children:"Threats Mitigated"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Threat"}),(0,t.jsx)(n.th,{children:"Mitigation"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Prompt injection"}),(0,t.jsx)(n.td,{children:"Policy enforcement, human approval"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Agent hallucination"}),(0,t.jsx)(n.td,{children:"Same as above"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Unauthorized actions"}),(0,t.jsx)(n.td,{children:"Governance rules deny"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Runaway automation"}),(0,t.jsx)(n.td,{children:"Rate limiting, approval requirements"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"threats-not-mitigated",children:"Threats NOT Mitigated"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Threat"}),(0,t.jsx)(n.th,{children:"Why"}),(0,t.jsx)(n.th,{children:"Recommendation"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Compromised upstream"}),(0,t.jsx)(n.td,{children:"ThoughtGate trusts upstream responses"}),(0,t.jsx)(n.td,{children:"Secure your MCP servers"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Malicious policies"}),(0,t.jsx)(n.td,{children:"Policies are trusted configuration"}),(0,t.jsx)(n.td,{children:"Protect config files"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Insider threat"}),(0,t.jsx)(n.td,{children:"Approvers can approve anything"}),(0,t.jsx)(n.td,{children:"Multi-approver (planned)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Network eavesdropping"}),(0,t.jsx)(n.td,{children:"No built-in TLS"}),(0,t.jsx)(n.td,{children:"Use service mesh"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"security-properties",children:"Security Properties"}),"\n",(0,t.jsx)(n.h3,{id:"1-fail-safe-defaults",children:"1. Fail-Safe Defaults"}),"\n",(0,t.jsxs)(n.p,{children:["If ThoughtGate cannot evaluate a request, it ",(0,t.jsx)(n.strong,{children:"denies"})," rather than allows:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Policy parse error \u2192 Deny"}),"\n",(0,t.jsx)(n.li,{children:"Policy evaluation error \u2192 Deny"}),"\n",(0,t.jsx)(n.li,{children:"Unknown action \u2192 Deny"}),"\n",(0,t.jsxs)(n.li,{children:["No matching rule \u2192 Uses ",(0,t.jsx)(n.code,{children:"defaults.action"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-policy-immutability",children:"2. Policy Immutability"}),"\n",(0,t.jsx)(n.p,{children:"Policies cannot be modified by:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"AI agent requests"}),"\n",(0,t.jsx)(n.li,{children:"Upstream responses"}),"\n",(0,t.jsx)(n.li,{children:"Slack messages"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Policies only change when:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The config file on disk changes"}),"\n",(0,t.jsx)(n.li,{children:"ThoughtGate restarts with a new file"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-approval-independence",children:"3. Approval Independence"}),"\n",(0,t.jsx)(n.p,{children:"Approval decisions are made by humans through Slack, completely independent of:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The AI agent making the request"}),"\n",(0,t.jsx)(n.li,{children:"The content of the request"}),"\n",(0,t.jsx)(n.li,{children:"Previous approval decisions"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"4-audit-trail",children:"4. Audit Trail"}),"\n",(0,t.jsx)(n.p,{children:"All decisions are logged:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Request details (method, tool name)"}),"\n",(0,t.jsx)(n.li,{children:"Policy evaluation result"}),"\n",(0,t.jsx)(n.li,{children:"Action taken"}),"\n",(0,t.jsx)(n.li,{children:"Approval outcome (if applicable)"}),"\n",(0,t.jsx)(n.li,{children:"Timing information"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"deployment-security",children:"Deployment Security"}),"\n",(0,t.jsx)(n.h3,{id:"network-security",children:"Network Security"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Recommended: Only expose admin port internally\nspec:\n  containers:\n    - name: thoughtgate\n      ports:\n        - containerPort: 7467  # Proxy: localhost only\n          name: proxy\n        - containerPort: 7469  # Admin: internal network\n          name: admin\n"})}),"\n",(0,t.jsx)(n.h3,{id:"secret-management",children:"Secret Management"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Use Kubernetes secrets for Slack token\nenv:\n  - name: THOUGHTGATE_SLACK_BOT_TOKEN\n    valueFrom:\n      secretKeyRef:\n        name: thoughtgate-secrets\n        key: slack-token\n"})}),"\n",(0,t.jsx)(n.h3,{id:"config-protection",children:"Config Protection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Mount config as read-only\nvolumeMounts:\n  - name: config\n    mountPath: /etc/thoughtgate\n    readOnly: true\n"})}),"\n",(0,t.jsx)(n.h2,{id:"slack-security",children:"Slack Security"}),"\n",(0,t.jsx)(n.h3,{id:"bot-token-scopes",children:"Bot Token Scopes"}),"\n",(0,t.jsx)(n.p,{children:"Minimize permissions:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Scope"}),(0,t.jsx)(n.th,{children:"Required"}),(0,t.jsx)(n.th,{children:"Purpose"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"chat:write"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Post approval messages"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"reactions:read"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Detect approval reactions"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"channels:history"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Poll for reactions"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"users:read"})}),(0,t.jsx)(n.td,{children:"Optional"}),(0,t.jsx)(n.td,{children:"Resolve display names"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"channel-security",children:"Channel Security"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use a ",(0,t.jsx)(n.strong,{children:"private channel"})," for approvals"]}),"\n",(0,t.jsx)(n.li,{children:"Only invite trusted approvers"}),"\n",(0,t.jsx)(n.li,{children:"Consider separate channels for different sensitivity levels"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"approval-authentication",children:"Approval Authentication"}),"\n",(0,t.jsx)(n.p,{children:"Currently, any user who can react to messages can approve. Planned improvements:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Approver allowlists"}),"\n",(0,t.jsx)(n.li,{children:"Multi-approver requirements"}),"\n",(0,t.jsx)(n.li,{children:"Time-based access windows"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"ndjson-smuggling-detection",children:"NDJSON Smuggling Detection"}),"\n",(0,t.jsxs)(n.p,{children:["In stdio mode, MCP messages are newline-delimited JSON (NDJSON). A ",(0,t.jsx)(n.strong,{children:"smuggling attack"})," embeds extra JSON-RPC messages within a single NDJSON line \u2014 for example, appending a second ",(0,t.jsx)(n.code,{children:'{"jsonrpc":"2.0",...}'})," after the first, hoping the governance layer processes only the first (benign) message while the MCP server processes both."]}),"\n",(0,t.jsx)(n.h3,{id:"how-thoughtgate-detects-it",children:"How ThoughtGate Detects It"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Splits the raw line on ",(0,t.jsx)(n.code,{children:"0x0A"})," (newline) boundaries"]}),"\n",(0,t.jsxs)(n.li,{children:["Checks each segment for the presence of a ",(0,t.jsx)(n.code,{children:"jsonrpc"})," key"]}),"\n",(0,t.jsxs)(n.li,{children:["If multiple segments contain ",(0,t.jsx)(n.code,{children:"jsonrpc"}),", the message is flagged as smuggled"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"profile-behavior",children:"Profile Behavior"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Profile"}),(0,t.jsx)(n.th,{children:"Behavior"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Production"})}),(0,t.jsxs)(n.td,{children:["Smuggled messages are ",(0,t.jsx)(n.strong,{children:"rejected"})," \u2014 dropped before reaching the upstream server"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Development"})}),(0,t.jsxs)(n.td,{children:["Smuggled messages are logged as ",(0,t.jsx)(n.code,{children:"WOULD_REJECT"})," but ",(0,t.jsx)(n.strong,{children:"forwarded"})," for observation"]})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"profile-security-implications",children:"Profile Security Implications"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"--profile"})," flag has significant security implications:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Production"}),(0,t.jsx)(n.th,{children:"Development"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Governance errors"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"Fail-closed"})," (deny on error)"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"Fail-open"})," (forward on error)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Approval workflows"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"Enforced"})," (Slack required)"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"Auto-approved"})," (no Slack needed)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Smuggling detection"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"Enforced"})," (reject)"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"Log-only"})," (forward)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Decision prefix"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"BLOCKED"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"WOULD_BLOCK"})})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["Development mode intentionally weakens security to aid observation and testing. ",(0,t.jsx)(n.strong,{children:"Never use development mode in production environments."})]})}),"\n",(0,t.jsx)(n.h2,{id:"cli-wrapper-security",children:"CLI Wrapper Security"}),"\n",(0,t.jsxs)(n.p,{children:["The CLI wrapper (",(0,t.jsx)(n.code,{children:"thoughtgate wrap"}),") modifies agent config files on disk. Several safeguards protect against data loss and leakage:"]}),"\n",(0,t.jsx)(n.h3,{id:"config-file-protection",children:"Config File Protection"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Advisory file lock"})," (",(0,t.jsx)(n.code,{children:".thoughtgate-lock"}),") prevents concurrent ThoughtGate instances from modifying the same config"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Atomic backup"})," (",(0,t.jsx)(n.code,{children:".thoughtgate-backup"}),") \u2014 byte-for-byte copy created before any modification"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Panic hook"})," \u2014 config is restored even if ThoughtGate panics (unwind)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Signal handler"})," \u2014 SIGTERM, SIGINT trigger config restoration before exit"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"environment-variable-scrubbing",children:"Environment Variable Scrubbing"}),"\n",(0,t.jsxs)(n.p,{children:["ThoughtGate injects environment variables (",(0,t.jsx)(n.code,{children:"THOUGHTGATE_ACTIVE"}),", ",(0,t.jsx)(n.code,{children:"THOUGHTGATE_SERVER_ID"}),", ",(0,t.jsx)(n.code,{children:"THOUGHTGATE_GOVERNANCE_ENDPOINT"}),") into the agent's subprocess. These are ",(0,t.jsx)(n.strong,{children:"scrubbed"})," from child process environments to prevent leakage to MCP servers or other subprocesses."]}),"\n",(0,t.jsx)(n.h3,{id:"governance-service-binding",children:"Governance Service Binding"}),"\n",(0,t.jsxs)(n.p,{children:["The governance HTTP service binds to ",(0,t.jsx)(n.code,{children:"127.0.0.1"})," only \u2014 it is never accessible from the network. An OS-assigned ephemeral port is used by default, preventing port conflicts."]}),"\n",(0,t.jsx)(n.h2,{id:"hardening-checklist",children:"Hardening Checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Run as non-root user"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use read-only root filesystem"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Drop all capabilities"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Set resource limits"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use private Slack channel"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Rotate Slack token regularly"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Monitor approval patterns"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Alert on config load failures"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Enable structured logging"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use TLS for all network traffic"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"example-secure-deployment",children:"Example Secure Deployment"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Pod\nmetadata:\n  name: agent-secure\nspec:\n  securityContext:\n    runAsNonRoot: true\n    runAsUser: 1000\n    fsGroup: 1000\n  containers:\n    - name: thoughtgate\n      image: ghcr.io/thoughtgate/thoughtgate:v0.3.0\n      securityContext:\n        readOnlyRootFilesystem: true\n        allowPrivilegeEscalation: false\n        capabilities:\n          drop:\n            - ALL\n      resources:\n        limits:\n          memory: "100Mi"\n          cpu: "200m"\n      env:\n        - name: THOUGHTGATE_CONFIG\n          value: "/etc/thoughtgate/config.yaml"\n        - name: THOUGHTGATE_SLACK_BOT_TOKEN\n          valueFrom:\n            secretKeyRef:\n              name: thoughtgate-secrets\n              key: slack-token\n      volumeMounts:\n        - name: config\n          mountPath: /etc/thoughtgate\n          readOnly: true\n  volumes:\n    - name: config\n      configMap:\n        name: thoughtgate-config\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);