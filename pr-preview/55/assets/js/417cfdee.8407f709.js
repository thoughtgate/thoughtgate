"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[984],{6365(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>a,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"how-to/wrap-agents","title":"Wrap MCP Agents","description":"How to use thoughtgate wrap with each supported agent type.","source":"@site/docs/how-to/wrap-agents.md","sourceDirName":"how-to","slug":"/how-to/wrap-agents","permalink":"/pr-preview/55/docs/how-to/wrap-agents","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/how-to/wrap-agents.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Install ThoughtGate","permalink":"/pr-preview/55/docs/how-to/install"},"next":{"title":"Write Governance Rules","permalink":"/pr-preview/55/docs/how-to/write-policies"}}');var d=s(4848),t=s(8453);const i={sidebar_position:3},o="Wrap MCP Agents",c={},l=[{value:"How Auto-Detection Works",id:"how-auto-detection-works",level:2},{value:"Claude Code",id:"claude-code",level:2},{value:"Claude Desktop",id:"claude-desktop",level:2},{value:"Cursor",id:"cursor",level:2},{value:"VS Code",id:"vs-code",level:2},{value:"Windsurf",id:"windsurf",level:2},{value:"Zed",id:"zed",level:2},{value:"Custom Agents",id:"custom-agents",level:2},{value:"Overriding Detection",id:"overriding-detection",level:2},{value:"Override Agent Type",id:"override-agent-type",level:3},{value:"Override Config Path",id:"override-config-path",level:3},{value:"Linux Paths",id:"linux-paths",level:2},{value:"Double-Wrap Prevention",id:"double-wrap-prevention",level:2},{value:"Config Backup and Restore",id:"config-backup-and-restore",level:2},{value:"See Also",id:"see-also",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"wrap-mcp-agents",children:"Wrap MCP Agents"})}),"\n",(0,d.jsxs)(n.p,{children:["How to use ",(0,d.jsx)(n.code,{children:"thoughtgate wrap"})," with each supported agent type."]}),"\n",(0,d.jsx)(n.h2,{id:"how-auto-detection-works",children:"How Auto-Detection Works"}),"\n",(0,d.jsx)(n.p,{children:"ThoughtGate detects the agent type from the command basename (the last component of the command path):"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'# Auto-detected as Claude Code (basename: "claude-code")\nthoughtgate wrap -- claude-code\n\n# Auto-detected as Cursor (basename: "cursor")\nthoughtgate wrap -- cursor\n\n# Auto-detected as VS Code (basename: "code")\nthoughtgate wrap -- code\n\n# Full paths work too (basename: "claude-code")\nthoughtgate wrap -- /usr/local/bin/claude-code\n'})}),"\n",(0,d.jsxs)(n.p,{children:["If detection fails, ThoughtGate exits with an error. Use ",(0,d.jsx)(n.code,{children:"--agent-type"})," to override."]}),"\n",(0,d.jsx)(n.h2,{id:"claude-code",children:"Claude Code"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap -- claude-code\n# or\nthoughtgate wrap -- claude\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Config file:"})," ",(0,d.jsx)(n.code,{children:"~/.claude.json"})," (per-project servers under ",(0,d.jsx)(n.code,{children:"projects.<cwd>.mcpServers"}),")"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["ThoughtGate reads ",(0,d.jsx)(n.code,{children:"~/.claude.json"})," and finds servers for the current working directory"]}),"\n",(0,d.jsxs)(n.li,{children:["Merges any ",(0,d.jsx)(n.code,{children:".mcp.json"})," servers from the project directory"]}),"\n",(0,d.jsx)(n.li,{children:"Filters to stdio-only servers (HTTP/SSE servers are skipped)"}),"\n",(0,d.jsxs)(n.li,{children:["Expands ",(0,d.jsx)(n.code,{children:"${VAR}"})," and ",(0,d.jsx)(n.code,{children:"${VAR:-default}"})," environment variable references"]}),"\n",(0,d.jsxs)(n.li,{children:["Rewrites each server's ",(0,d.jsx)(n.code,{children:"command"})," to route through the ThoughtGate shim"]}),"\n",(0,d.jsx)(n.li,{children:"Launches Claude Code with the rewritten config"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Non-stdio servers (",(0,d.jsx)(n.code,{children:'"type": "http"'}),", ",(0,d.jsx)(n.code,{children:'"type": "sse"'}),") are left unchanged \u2014 ThoughtGate only governs stdio servers"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:".mcp.json"})," entries override ",(0,d.jsx)(n.code,{children:"~/.claude.json"})," entries when they share the same server ID"]}),"\n",(0,d.jsxs)(n.li,{children:["The ",(0,d.jsx)(n.code,{children:"enabledMcpjsonServers"})," and ",(0,d.jsx)(n.code,{children:"disabledMcpjsonServers"})," arrays in ",(0,d.jsx)(n.code,{children:"~/.claude.json"})," are respected"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"claude-desktop",children:"Claude Desktop"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap -- claude-desktop\n# or for macOS app bundle:\nthoughtgate wrap -- /Applications/Claude.app/Contents/MacOS/Claude\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Config file:"})," ",(0,d.jsx)(n.code,{children:"~/Library/Application Support/Claude/claude_desktop_config.json"})," (macOS) or ",(0,d.jsx)(n.code,{children:"~/.config/Claude/claude_desktop_config.json"})," (Linux)"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"ThoughtGate reads the Claude Desktop config"}),"\n",(0,d.jsxs)(n.li,{children:["Rewrites all servers under ",(0,d.jsx)(n.code,{children:"mcpServers"})]}),"\n",(0,d.jsx)(n.li,{children:"Launches Claude Desktop"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"cursor",children:"Cursor"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap -- cursor\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Config files:"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Global: ",(0,d.jsx)(n.code,{children:"~/.cursor/mcp.json"})]}),"\n",(0,d.jsxs)(n.li,{children:["Project: ",(0,d.jsx)(n.code,{children:".cursor/mcp.json"})," (in working directory)"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"ThoughtGate reads the global config"}),"\n",(0,d.jsx)(n.li,{children:"Merges project-level overrides (project entries override global by server ID)"}),"\n",(0,d.jsxs)(n.li,{children:["Rewrites all servers under ",(0,d.jsx)(n.code,{children:"mcpServers"})]}),"\n",(0,d.jsx)(n.li,{children:"Launches Cursor"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"vs-code",children:"VS Code"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap -- code\n# or for Insiders:\nthoughtgate wrap -- code-insiders\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Config file:"})," ",(0,d.jsx)(n.code,{children:".vscode/mcp.json"})," (workspace-level only)"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"ThoughtGate reads the workspace MCP config"}),"\n",(0,d.jsxs)(n.li,{children:["Filters to ",(0,d.jsx)(n.code,{children:'"type": "stdio"'})," entries only (SSE and other types are skipped)"]}),"\n",(0,d.jsxs)(n.li,{children:["Rewrites under the ",(0,d.jsx)(n.code,{children:"servers"})," key (note: VS Code uses ",(0,d.jsx)(n.code,{children:"servers"}),", not ",(0,d.jsx)(n.code,{children:"mcpServers"}),")"]}),"\n",(0,d.jsx)(n.li,{children:"Launches VS Code"}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Note:"})," VS Code's MCP config uses ",(0,d.jsx)(n.code,{children:'"servers"'})," as the top-level key, not ",(0,d.jsx)(n.code,{children:'"mcpServers"'}),"."]}),"\n",(0,d.jsx)(n.h2,{id:"windsurf",children:"Windsurf"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap -- windsurf\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Config file:"})," ",(0,d.jsx)(n.code,{children:"~/.codeium/windsurf/mcp_config.json"})]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"ThoughtGate reads the Windsurf config"}),"\n",(0,d.jsxs)(n.li,{children:["Expands ",(0,d.jsx)(n.code,{children:"${env:VAR}"})," environment variable references (Windsurf's syntax)"]}),"\n",(0,d.jsxs)(n.li,{children:["Rewrites all servers under ",(0,d.jsx)(n.code,{children:"mcpServers"})]}),"\n",(0,d.jsx)(n.li,{children:"Launches Windsurf"}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Note:"})," Windsurf uses ",(0,d.jsx)(n.code,{children:"${env:VAR}"})," syntax (with ",(0,d.jsx)(n.code,{children:"env:"})," prefix), unlike Claude Code's ",(0,d.jsx)(n.code,{children:"${VAR}"})," syntax. Plain ",(0,d.jsx)(n.code,{children:"${VAR}"})," without the prefix is left unchanged."]}),"\n",(0,d.jsx)(n.h2,{id:"zed",children:"Zed"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap -- zed\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Config file:"})," ",(0,d.jsx)(n.code,{children:"~/.config/zed/settings.json"})]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"ThoughtGate reads the Zed settings"}),"\n",(0,d.jsxs)(n.li,{children:["Parses servers under ",(0,d.jsx)(n.code,{children:"context_servers"})," (Zed's unique key name)"]}),"\n",(0,d.jsxs)(n.li,{children:["Handles Zed's nested command format: ",(0,d.jsx)(n.code,{children:'{ "command": { "path": "...", "args": [...] } }'})]}),"\n",(0,d.jsx)(n.li,{children:"Launches Zed"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"custom-agents",children:"Custom Agents"}),"\n",(0,d.jsxs)(n.p,{children:["For agents not in the supported list, use ",(0,d.jsx)(n.code,{children:"--agent-type custom"})," with ",(0,d.jsx)(n.code,{children:"--config-path"}),":"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap \\\n  --agent-type custom \\\n  --config-path ./my-agent-config.json \\\n  -- ./my-agent\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The custom agent's config must use the ",(0,d.jsx)(n.code,{children:"mcpServers"})," key format (same as Claude Desktop / Cursor)."]}),"\n",(0,d.jsx)(n.h2,{id:"overriding-detection",children:"Overriding Detection"}),"\n",(0,d.jsx)(n.h3,{id:"override-agent-type",children:"Override Agent Type"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# Force Cursor adapter for a forked build\nthoughtgate wrap --agent-type cursor -- /opt/cursor-fork/cursor\n"})}),"\n",(0,d.jsx)(n.h3,{id:"override-config-path",children:"Override Config Path"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# Use a specific config file instead of auto-discovered path\nthoughtgate wrap --config-path ~/testing/mcp.json -- claude-code\n"})}),"\n",(0,d.jsx)(n.h2,{id:"linux-paths",children:"Linux Paths"}),"\n",(0,d.jsx)(n.p,{children:"On Linux, ThoughtGate follows XDG conventions where applicable:"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Agent"}),(0,d.jsx)(n.th,{children:"macOS Path"}),(0,d.jsx)(n.th,{children:"Linux Path"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Claude Desktop"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"~/Library/Application Support/Claude/"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"~/.config/Claude/"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Zed"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"~/Library/Application Support/zed/"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"~/.config/zed/"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Others"}),(0,d.jsx)(n.td,{children:"Home directory"}),(0,d.jsx)(n.td,{children:"Same as macOS"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"double-wrap-prevention",children:"Double-Wrap Prevention"}),"\n",(0,d.jsx)(n.p,{children:"If you accidentally try to wrap an already-wrapped agent, ThoughtGate detects it and exits:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"Error: Config already managed by ThoughtGate \u2014 run the agent directly or restore with `thoughtgate unwrap`\n"})}),"\n",(0,d.jsx)(n.p,{children:"Detection works two ways:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Config-level:"})," Checks if any server's ",(0,d.jsx)(n.code,{children:"command"})," already points to the ",(0,d.jsx)(n.code,{children:"thoughtgate"})," binary"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Process-level:"})," Checks for the ",(0,d.jsx)(n.code,{children:"THOUGHTGATE_ACTIVE=1"})," environment variable"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"config-backup-and-restore",children:"Config Backup and Restore"}),"\n",(0,d.jsx)(n.p,{children:"When wrapping, ThoughtGate creates a backup of the original config:"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"File"}),(0,d.jsx)(n.th,{children:"Purpose"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"<config>.thoughtgate-backup"})}),(0,d.jsx)(n.td,{children:"Byte-for-byte copy of the original config"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"<config>.thoughtgate-lock"})}),(0,d.jsx)(n.td,{children:"Advisory lock preventing concurrent modifications"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"On exit (normal, SIGTERM, SIGINT, or panic), the original config is automatically restored from the backup."}),"\n",(0,d.jsx)(n.p,{children:"To skip automatic restoration:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"thoughtgate wrap --no-restore -- claude-code\n"})}),"\n",(0,d.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.a,{href:"/docs/reference/cli",children:"CLI Reference"})," \u2014 Complete flag documentation"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.a,{href:"/docs/reference/supported-agents",children:"Supported Agents"})," \u2014 Config format details"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.a,{href:"/docs/how-to/use-profiles",children:"Use Profiles"})," \u2014 Development vs production modes"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},8453(e,n,s){s.d(n,{R:()=>i,x:()=>o});var r=s(6540);const d={},t=r.createContext(d);function i(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);